# Core Aliases and Development Functions

# Git workflow shortcuts
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline -10'
alias gd='git diff'

# Quick commit with conventional commit format
function quick-commit() {
    local type="$1"
    local message="$2"

    if [ -z "$type" ] || [ -z "$message" ]; then
        echo "Usage: quick-commit <type> <message>"
        echo "Types: feat, fix, docs, style, refactor, test, chore"
        return 1
    fi

    git add .
    git commit -m "$type: $message"
    echo "‚úÖ Committed: $type: $message"
}

# Clean merged branches
function git-clean-branches() {
    git branch --merged | grep -v "\*\|main\|master" | xargs -n 1 git branch -d
}

# Package management - smart installer that detects package manager
function smart-install() {
    local package="$1"
    local dev_flag="$2"

    if [ -z "$package" ]; then
        echo "Usage: smart-install <package> [--dev]"
        return 1
    fi

    # Detect package manager by lockfile
    if [ -f "bun.lockb" ] && command -v bun &> /dev/null; then
        if [ "$dev_flag" = "--dev" ]; then
            bun add -d "$package"
        else
            bun add "$package"
        fi
    elif [ -f "pnpm-lock.yaml" ] && command -v pnpm &> /dev/null; then
        if [ "$dev_flag" = "--dev" ]; then
            pnpm add -D "$package"
        else
            pnpm add "$package"
        fi
    elif [ -f "yarn.lock" ] && command -v yarn &> /dev/null; then
        if [ "$dev_flag" = "--dev" ]; then
            yarn add -D "$package"
        else
            yarn add "$package"
        fi
    else
        if [ "$dev_flag" = "--dev" ]; then
            npm install -D "$package"
        else
            npm install "$package"
        fi
    fi
}

# Fresh install - remove node_modules and reinstall
function npm-fresh() {
    rm -rf node_modules package-lock.json
    npm install
}

function bun-fresh() {
    rm -rf node_modules bun.lockb
    bun install
}

# Project health check
function project-health() {
    echo "üîç Checking project health..."

    if [ ! -f "package.json" ]; then
        echo "‚ùå No package.json found"
        return 1
    fi

    echo "üì¶ Checking for outdated dependencies..."
    npm outdated

    echo "üîí Security audit..."
    npm audit --audit-level moderate

    if [ -f "tsconfig.json" ]; then
        echo "üîß TypeScript check..."
        npx tsc --noEmit
    fi

    echo "‚úÖ Health check complete"
}

# Development server - smart detection
function dev() {
    if [ -f "package.json" ]; then
        if grep -q '"dev"' package.json; then
            if command -v bun &> /dev/null && [ -f "bun.lockb" ]; then
                bun run dev
            else
                npm run dev
            fi
        elif grep -q '"start"' package.json; then
            if command -v bun &> /dev/null && [ -f "bun.lockb" ]; then
                bun start
            else
                npm start
            fi
        else
            echo "No dev or start script found in package.json"
        fi
    else
        echo "No package.json found in current directory"
    fi
}

# Quick project navigation
function p() {
    cd ~/Projects/"$1"
}

# Completion for p function (if Projects directory exists)
if [ -d ~/Projects ]; then
    if [ -n "${ZSH_VERSION:-}" ] && command -v compdef >/dev/null 2>&1; then
        _p() {
            compadd $(ls ~/Projects)
        }
        compdef _p p
    fi
fi

# Environment management
function load-env() {
    if [ -f .env ]; then
        export $(cat .env | xargs)
        echo "‚úÖ Environment variables loaded from .env"
    else
        echo "‚ùå No .env file found"
    fi
}
