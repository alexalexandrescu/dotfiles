# Modern CLI Tool Enhancements
# Provides helpful shortcuts without breaking system commands

# Bat (cat alternative) - use explicit commands, don't override cat
if command -v bat &>/dev/null; then
    alias bcat='bat'  # Syntax highlighting
    alias bcatp='bat --style=plain'  # Plain output
    alias bcatl='bat --style=numbers'  # With line numbers

    export BAT_THEME="TwoDark"
    export BAT_STYLE="numbers,changes,header"
fi

# Eza/Exa (ls alternative) - provide shortcuts but don't override ls
if command -v eza &>/dev/null; then
    alias ll='eza -la --icons --git --group-directories-first'
    alias lt='eza --tree --level=2 --icons'
    alias llt='eza -la --icons --git --sort=modified'
elif command -v exa &>/dev/null; then
    alias ll='exa -la --icons --git --group-directories-first'
    alias lt='exa --tree -L 2 --icons'
    alias llt='exa -la --icons --git --sort=modified'
fi

# Fd (find alternative) - provide shortcuts for common patterns
if command -v fd &>/dev/null; then
    # Find files by name pattern
    ff() {
        local pattern="${1:-}"
        local path="${2:-.}"
        if [[ -z "$pattern" ]]; then
            echo "Usage: ff <pattern> [path]"
            return 1
        fi
        fd "$pattern" "$path" --type f
    }

    # Find directories by name pattern
    ffd() {
        local pattern="${1:-}"
        local path="${2:-.}"
        if [[ -z "$pattern" ]]; then
            echo "Usage: ffd <pattern> [path]"
            return 1
        fi
        fd "$pattern" "$path" --type d
    }
fi

# Ripgrep (grep alternative) - provide shortcuts for common patterns
if command -v rg &>/dev/null; then
    # Smart search with context
    search() {
        local pattern="${1:-}"
        local path="${2:-.}"
        if [[ -z "$pattern" ]]; then
            echo "Usage: search <pattern> [path]"
            return 1
        fi
        rg "$pattern" "$path" --smart-case --color=always --line-number --context=2
    }

    # Search JavaScript/TypeScript files
    searchjs() {
        rg "$1" --type js --type ts "${2:-.}"
    }
fi

# Zoxide integration (smart cd)
if command -v zoxide &>/dev/null; then
    eval "$(zoxide init zsh)"
    alias zz='z -'  # Go back to previous directory
fi

# Starship prompt
if command -v starship &>/dev/null; then
    eval "$(starship init zsh)"
fi

# Direnv integration (environment switching)
if command -v direnv &>/dev/null; then
    eval "$(direnv hook zsh)"
fi

# FZF enhancements
if command -v fzf &>/dev/null; then
    # Use fd for fzf if available
    if command -v fd &>/dev/null; then
        export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git --exclude node_modules'
        export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
        export FZF_ALT_C_COMMAND='fd --type d --hidden --follow --exclude .git --exclude node_modules'
    fi

    # Enhanced default options with bat preview if available
    if command -v bat &>/dev/null; then
        export FZF_DEFAULT_OPTS="--height=40% --layout=reverse --border --preview='bat --color=always --style=numbers --line-range=:500 {}' --preview-window='right:60%:wrap'"
    else
        export FZF_DEFAULT_OPTS="--height=40% --layout=reverse --border"
    fi

    # Fuzzy file opener
    fo() {
        local file
        file=$(fzf --query="$1" --select-1 --exit-0)
        [ -n "$file" ] && ${EDITOR:-vim} "$file"
    }

    # Fuzzy directory changer
    fcd() {
        local dir
        if command -v fd &>/dev/null; then
            dir=$(fd --type d | fzf --query="$1" --select-1 --exit-0)
        else
            dir=$(find . -type d 2>/dev/null | fzf --query="$1" --select-1 --exit-0)
        fi
        [ -n "$dir" ] && cd "$dir"
    }

    # Git branch switcher
    fgb() {
        local branch
        branch=$(git branch --all | grep -v HEAD | sed 's/^..//g' | sed 's#remotes/[^/]*/##g' | sort -u | fzf)
        [ -n "$branch" ] && git checkout "$branch"
    }
fi

# GitHub CLI shortcuts
if command -v gh &>/dev/null; then
    alias ghpr='gh pr create'
    alias ghprs='gh pr status'
    alias ghprl='gh pr list'
fi

# LazyGit
if command -v lazygit &>/dev/null; then
    alias lg='lazygit'
fi
